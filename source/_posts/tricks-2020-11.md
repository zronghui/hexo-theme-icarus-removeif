---
title: tricks-2020-11
toc: true
recommend: 1
uniqueId: '2020-11-04 06:16:58/"tricks-2020-11".html'
encrypt: true
password: 1
abstract: 咦，这是一篇加密文章，好像需要输入密码才能查看呢！
message: 嗨，请准确无误地输入密码查看哟
wrong_pass_message: 不好意思，密码没对哦，在检查检查呢！
wrong_hash_message: 不好意思，信息无法验证！
date: 2020-11-04 14:16:58
thumbnail:
categories:
tags:
keywords:
---



[TOC]

<!--more-->



# 编程

## Python

### A Django REST API in a Single File

[A Django REST API in a Single File - Adam Johnson](https://adamj.eu/tech/2020/10/15/a-single-file-rest-api-in-django/)

```python
import os
import sys
from dataclasses import dataclass

from django.conf import settings
from django.core.wsgi import get_wsgi_application
from django.http import HttpResponseRedirect, JsonResponse
from django.urls import path
from django.utils.crypto import get_random_string

settings.configure(
    DEBUG=(os.environ.get("DEBUG", "") == "1"),
    ALLOWED_HOSTS=["*"],  # Disable host header validation
    ROOT_URLCONF=__name__,  # Make this module the urlconf
    SECRET_KEY=get_random_string(
        50
    ),  # We aren't using any security features but Django requires this setting
    MIDDLEWARE=["django.middleware.common.CommonMiddleware"],
)


@dataclass
class Character:
    name: str
    age: int

    def as_dict(self, id_):
        return {
            "id": id_,
            "name": self.name,
            "age": self.age,
        }


characters = {
    1: Character("Rick Sanchez", 70),
    2: Character("Morty Smith", 14),
}


def index(request):
    return HttpResponseRedirect("/characters/")


def characters_list(request):
    return JsonResponse(
        {"data": [character.as_dict(id_) for id_, character in characters.items()]}
    )


def characters_detail(request, character_id):
    try:
        character = characters[character_id]
    except KeyError:
        return JsonResponse(
            status=404,
            data={"error": f"Character with id {character_id!r} does not exist."},
        )
    return JsonResponse({"data": character.as_dict(character_id)})


urlpatterns = [
    path("", index),
    path("characters/", characters_list),
    path("characters/<int:character_id>/", characters_detail),
]

app = get_wsgi_application()

if __name__ == "__main__":
    from django.core.management import execute_from_command_line

    execute_from_command_line(sys.argv)

```



## Java

### Java 字符串常量存放在堆内存还是 JAVA 方法区？

JDK1.7 及之后版本的 JVM 已经将运行时常量池从方法区中移了出来，在 Java 堆（Heap）中开辟了一块区域存放运行时常量池。

　　JDK1.8 开始，取消了 Java 方法区，取而代之的是位于直接内存的元空间（metaSpace）。

### Redis 为什么这么快

[硬核！15 张图解 Redis 为什么这么快 - 51CTO.COM](https://stor.51cto.com/art/202010/629200.htm)

基于内存实现

数据都存储在内存里，减少了一些不必要的 I/O 操作，操作速率很快。
高效的数据结构

底层多种数据结构支持不同的数据类型，支持 Redis 存储不同的数据；
不同数据结构的设计，使得数据存储时间复杂度降到最低。
合理的数据编码

根据字符串的长度及元素的个数适配不同的编码格式。
合适的线程模型

I/O 多路复用模型同时监听客户端连接；
单线程在执行过程中不需要进行上下文切换，减少了耗时。





[oracle/graal: GraalVM: Run Programs Faster Anywhere](https://github.com/oracle/graal?utm_source=gold_browser_extension)
[Getting Started with GraalVM](https://www.graalvm.org/docs/getting-started/)
[braisdom/ObjectiveSql: ObjectiveSQL is an ORM framework in Java base on ActiveRecord pattern, which encourages rapid development and clean, codes with the least and convention over configuration.](https://github.com/braisdom/ObjectiveSql?utm_source=gold_browser_extension)



### 分布式锁用 Redis 还是 Zookeeper？

[分布式锁用 Redis 还是 Zookeeper？](https://mp.weixin.qq.com/s?__biz=MzIwMTY0NDU3Nw==&mid=2651947327&idx=1&sn=f6c259e9fe826d0c3e56326b2826bd43&chksm=8d0fee71ba786767fa776e77de9bc2af4bc0a2620ee6f9fe11d5022dd83e483d469e44609880&mpshare=1&scene=1&srcid=1108nvYAdLdJW3jNmVmigKFV&sharer_sharetime=1604837608581&sharer_shareid=e780165b85dddf2dc106811592851c29#rd)

以下是自己从文章中简单归纳的几个要点

**什么是分布式锁？**

分布式场景下，给资源加锁，防止出现不合理的情况，如库存超卖

与单机你的多线程锁功能类似



**Redis 怎么实现分布式锁？**

Redis 中不存在一个 key，可以认为没有锁，然后自己就可以设置 key unique_value expire_time, 设置成功的话，自己就获取到了锁，释放锁的时候把 key 删除。获取锁失败的话可以自旋几次

此外，用开源框架 Reddisson 实现可以省略很多是线上的细节





**zookeeper 怎么实现分布式锁？**

首先需要了解 zookeeper 中存在 **有序节点** **临时节点**  **事件监听** 这几个概念：

有序节点生成的 ID 自增

临时节点 在会话结束或超时后 会被 zookeeper 删除

事件监听 可以设置在 节点创建 删除 更改 子节点变更 时 发送通知给客户端



zookeeper 实现分布式锁的思路：

创建自己的 有序的临时节点，如果当前的 id 是最小的，那么获取锁成功；

否则监控比自己小的前一个节点，当那个节点被删除时，获取锁成功

如zookeeper 中有 3 个临时节点  /lock-001 /lock-002  /lock-003

当前创建的是 003，那么锁获取的逻辑是这样的，

001是最小的节点，最先获得锁，处理完之后 001 被删除，完成锁的释放

001 被删除，002 会收到通知，获得锁，处理完之后 002 被删除，完成锁的释放

002 被删除，003 会收到通知，获得锁，处理完之后 003 被删除，完成锁的释放







**Redis zookeeper 实现分布式锁 的异同 优缺点 怎么选择？**

可以看出，Redis 获取锁失败会不断重试，消耗性能；zookeeper 只需要设置一个监听器

而且，Redis 的锁的设计可能会出现问题

综上，比较推荐使用 zookeeper 实现分布式锁



### x &= (-x)

[What does x&(-x) [lowbit] do in C++? - Quora](https://www.quora.com/What-does-x-x-lowbit-do-in-C++)

-x == ~x + 1

example:
x=122 (base 10)
x=01111010
~x=10000101
~x+1=10000110
x&(~x+1)=00000010

## go

## cli

## git

## shell

## 前端

## 后端

[thingsboard/thingsboard: Open-source IoT Platform - Device management, data collection, processing and visualization.](https://github.com/thingsboard/thingsboard?utm_source=gold_browser_extension)

Open-source IoT Platform - Device management, data collection, processing and visualization.



[iluwatar/java-design-patterns: Design patterns implemented in Java](https://github.com/iluwatar/java-design-patterns?utm_source=gold_browser_extension)
[Patterns - Java Design Patterns](https://java-design-patterns.com/patterns/)



[mock-server/mockserver](https://github.com/mock-server/mockserver?utm_source=gold_browser_extension)

[MockServer](https://www.mock-server.com/)

MockServer enables easy mocking of any system you integrate with via HTTP or HTTPS with clients written in Java, JavaScript and Ruby. MockServer also includes a proxy that introspects all proxied traffic including encrypted SSL traffic and supports Port Forwarding, Web Proxying (i.e. HTTP proxy), HTTPS Tunneling Proxying (using HTTP CONNECT) and SOCKS Proxying (i.e. dynamic port forwarding)





MRR: Multi Range Read

NLJ: Index Nested-Loop Join

BNL: Block Nested-Loop Join

BKA: Batch Key Access

BKA 是利用 MRR 做的优化 NLJ





注释与空行

^(\s*)\n

^#.*$



[使用 logrotate 分割日志 | 码农笔记](https://liujavamail.github.io/2019/01/19/%E4%BD%BF%E7%94%A8lograge%E5%88%86%E5%89%B2%E6%97%A5%E5%BF%97/)
[一款简单的数据库备份工具 —gobackup | 码农笔记](https://liujavamail.github.io/2019/07/01/go-backup/)

#### MySQL 备份相关

[Backup and restore a mysql database from a running Docker mysql container](https://gist.github.com/spalladino/6d981f7b33f6e0afe6bb)
[Docker-MySql — 使用 mysqldump 命令备份导出 mysql 容器中的结构数据 - Linux 运维日志](https://www.centos.bz/2018/04/docker-mysql-%E4%BD%BF%E7%94%A8mysqldump-%E5%91%BD%E4%BB%A4%E5%A4%87%E4%BB%BD%E5%AF%BC%E5%87%BAmysql%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE/)

用 Navicat 更直接

## 项目

## 其他

### iterm 3.4更新

![image-20201127164553891](https://i.loli.net/2020/11/27/MkNHjl2wuA84sxP.png)

![image-20201127164611011](https://i.loli.net/2020/11/27/JSdapMH9w3PKcrC.png)

# 玩机

## Chrome

[JunzhouLiu/BILIBILI-HELPER](https://github.com/JunzhouLiu/BILIBILI-HELPER)



## Mac

### 制作「ASCII 流程图」工具 ——Graph Easy

[推荐一个制作「ASCII 流程图」工具 ——Graph Easy](https://juejin.cn/post/6844903510987767815)

### **QuiteRSS | AlternativeTo.net

[Mac Informer - Application downloads and editorial reviews for Mac OS X](https://macdownload.informer.com/)
[godenzim/readernotifier: Reader Notifier aims to supplement the official Mac Notifier menubar plugins for OS X, in adding support for Google Reader. Reader Notifier tells you when you have new unread rss/feed items available, and lets you visit those feeds without ever going to the Google Reader interface.](https://github.com/godenzim/readernotifier)
[alienhard/notify: Custom AgileZen notifications (RSS, mail, ...)](https://github.com/alienhard/notify)
[NetNewsWire Alternatives and Similar Software - AlternativeTo.net](https://alternativeto.net/software/netnewswire/)
[QuiteRSS Alternatives and Similar Software - AlternativeTo.net](https://alternativeto.net/software/quiterss/)
[Download | QuiteRSS](https://quiterss.org/en/download)



### v2ray

[gfwlist/gfwlist: The one and only one gfwlist here](https://github.com/gfwlist/gfwlist)

<img src="https://i.loli.net/2020/11/10/DxeIUfzAJ6Xc89N.png" alt="image-20201110120818734" style="zoom:33%;" />

https://raw.fastgit.org/gfwlist/gfwlist/master/gfwlist.txt

```
! Put user rules line by line in this file.
! See https://adblockplus.org/en/filter-cheatsheet
||workona.com
||googleapis.com
||raw.githubusercontent.com
```



<img src="https://i.loli.net/2020/11/10/W7EZMnsec1D5UX2.png" alt="image-20201110120843707" style="zoom:33%;" />

## Linux

## Android

[TeamNewPipe/NewPipe: A libre lightweight streaming front-end for Android.](https://github.com/TeamNewPipe/NewPipe?utm_source=gold_browser_extension)



## win

# 生活

# 网址

[https://zh.chaturbate.com](https://zh.chaturbate.com/)















[林美玲色情片 | Pornhub.com](https://cn.pornhub.com/video/search?search=%E6%9E%97%E7%BE%8E%E7%8E%B2)
[小姐姐教你如何穿戴姨妈巾 - Pornhub.com](https://cn.pornhub.com/view_video.php?viewkey=ph5e81ff0d67e1e)
[性爱导师闵儿淫荡讲解女性如何高潮出白浆 - Pornhub.com](https://cn.pornhub.com/view_video.php?viewkey=ph5ebec7808c782)
[朋友四十多岁的妈妈,太有韵味啦，舔鸡巴天生的熟妇，舒服的上天，太会搞啦 - Pornhub.com](https://cn.pornhub.com/view_video.php?viewkey=ph5ea8e5d7b9d00)









[tianxx7/jvm_action: jvm 讲解](https://github.com/tianxx7/jvm_action)
[tianxx7/high_concurrency: Java高并发发实战第二版](https://github.com/tianxx7/high_concurrency)

[后端技术 - 知乎](https://www.zhihu.com/column/c_1262794112555393024)



[天下无鱼 - 专注于矿业工程技术、矿业开发学习、工程软件、编程干货分享的小博客](https://shikey.com/)



[科技缪缪 - 知乎](https://www.zhihu.com/people/loveh-irving/posts)
[再深入一点|binlog和relay-log到底长啥样？ - 知乎](https://zhuanlan.zhihu.com/p/232806417)



[Many Tricks · Fine Mac Utilities](https://manytricks.com/)

[批量下载PDF | Mac 最佳应用软件](https://mba811.gitbooks.io/mac-best-app/content/zotero/05.html)
[DownThemAll! - Chrome 网上应用店](https://chrome.google.com/webstore/detail/downthemall/nljkibfhlpcnanjgbnlnbjecgicbjkge/related)



[极客时间-轻松学习，高效学习-极客邦](https://time.geekbang.org/?m=0&d=0&c=0&sort=2&order=desc)
[首页 - 天下无鱼](https://d.shikey.com/)

[极客算法 - 天下无鱼](https://d.shikey.com/%E6%9E%81%E5%AE%A2%E7%AE%97%E6%B3%95/)
[jike / 极客时间已完结 - 天下无鱼](https://d.shikey.com/jike/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4%E5%B7%B2%E5%AE%8C%E7%BB%93/)





### 实验室本周完成

reids 安装与配置

备份 MySQL 数据导入

申请服务器 minIO 服务搭建



